const kafka = require('kafka-node');

let conn = {'kafkaHost':'127.0.0.1:9092'};

var MQ = function (){
    this.mq_producers = {};
}

MQ.prototype.AddProducer = function (conn, handler){
    console.log('增加生产者',conn, this);
    let client = new kafka.KafkaClient(conn);
    let producer = new kafka.Producer(client);

    producer.on('ready', function(){
        if(!!handler){
            handler(producer);
        }
    });

    producer.on('error', function(err){
        console.error('producer error ',err.stack);
    });

    this.mq_producers['common'] = producer;
    return producer;
}
console.log(MQ);
var mq = new MQ();

let pointList = [
    { candidates:
            [ { prob: 0.00012634195260114443,
                point: 'POINT (118.04331626836287 24.590897818213726)' },
                { prob: 0.001996994621475117,
                    point: 'POINT (118.04335210443656 24.590955775061822)' },
                { prob: 0.3967627601155567,
                    point: 'POINT (118.04347354198173 24.591150033864707)' },
                { prob: 0.001996994621712676,
                    point: 'POINT (118.04335210443658 24.590955775061822)' },
                { prob: 0.39676276014066253,
                    point: 'POINT (118.04347354198173 24.59115003386471)' },
                { prob: 0.10111390329768612,
                    point: 'POINT (118.04342688652629 24.591072041205567)' },
                { prob: 0.10111390329768612,
                    point: 'POINT (118.04342688652629 24.591072041205567)' },
                { prob: 0.00012634195261949596,
                    point: 'POINT (118.04331626836289 24.590897818213726)' } ],
        time: 1592928012000,
        id: '1',
        point: 'POINT (118.04347354198173 24.59115003386471)' },
    { candidates:
            [ { prob: 0.00019709888164662513,
                point: 'POINT (118.04319016465388 24.5909629764296)' },
                { prob: 0.11091433785306358,
                    point: 'POINT (118.04329965284956 24.59113567973218)' },
                { prob: 0.11091433783925085,
                    point: 'POINT (118.04329965284954 24.59113567973218)' },
                { prob: 0.3860834643624551,
                    point: 'POINT (118.0433463106606 24.591213675771115)' },
                { prob: 0.0001970988816187673,
                    point: 'POINT (118.04319016465388 24.59096297642959)' },
                { prob: 0.0028050989308374247,
                    point: 'POINT (118.04322599678855 24.59102092821408)' },
                { prob: 0.3860834643202893,
                    point: 'POINT (118.0433463106606 24.591213675771105)' },
                { prob: 0.0028050989308382943,
                    point: 'POINT (118.04322599678855 24.59102092821407)' } ],
        time: 1592928342000,
        id: '2',
        point: 'POINT (118.0433463106606 24.591213675771115)' },
    { candidates:
            [ { prob: 0.0008226966109096853,
                point: 'POINT (118.04259342507983 24.59127789268004)' },
                { prob: 0.008483997785809445,
                    point: 'POINT (118.04263182767207 24.59133504685628)' },
                { prob: 0.3514444672938666,
                    point: 'POINT (118.04275100317018 24.591511899857558)' },
                { prob: 0.008483997788299693,
                    point: 'POINT (118.04263182767208 24.591335046856283)' },
                { prob: 0.0008226966109096853,
                    point: 'POINT (118.04259342507983 24.59127789268004)' },
                { prob: 0.13924883829946752,
                    point: 'POINT (118.04270121287917 24.59143698718713)' },
                { prob: 0.13924883829946752,
                    point: 'POINT (118.04270121287917 24.59143698718713)' },
                { prob: 0.3514444673112697,
                    point: 'POINT (118.0427510031702 24.59151189985756)' } ],
        time: 1592928492000,
        id: '3',
        point: 'POINT (118.0427510031702 24.59151189985756)' },
    { candidates:
            [ { prob: 0.11106245730000955,
                point: 'POINT (118.04006727992062 24.59349989856376)' },
                { prob: 0.22263060397470624,
                    point: 'POINT (118.03999279852299 24.59345097511485)' },
                { prob: 0.11106245731904126,
                    point: 'POINT (118.0400672799206 24.593499898563756)' },
                { prob: 0.22263060398587523,
                    point: 'POINT (118.03999279852299 24.593450975114845)' },
                { prob: 0.12620464013133467,
                    point: 'POINT (118.03988562809741 24.59337307238008)' },
                { prob: 0.12620464014116645,
                    point: 'POINT (118.03988562809741 24.59337307238009)' },
                { prob: 0.04010229858056259,
                    point: 'POINT (118.03982425628254 24.593331878431552)' },
                { prob: 0.04010229856730416,
                    point: 'POINT (118.03982425628253 24.59333187843156)' } ],
        time: 1592928522000,
        id: '4',
        point: 'POINT (118.03999279852299 24.593450975114845)' },
    { candidates:
            [ { prob: 0.06298894136625982,
                point: 'POINT (118.03997769978517 24.593470192864043)' },
                { prob: 0.20008531273323554,
                    point: 'POINT (118.0398050704554 24.593354330432664)' },
                { prob: 0.22781613384312233,
                    point: 'POINT (118.0398642050381 24.593397086318333)' },
                { prob: 0.20008531273323554,
                    point: 'POINT (118.0398050704554 24.59335433043266)' },
                { prob: 0.0629889413626733,
                    point: 'POINT (118.03997769978517 24.593470192864036)' },
                { prob: 0.009109612059994486,
                    point: 'POINT (118.04005218067891 24.59351911675743)' },
                { prob: 0.009109612058356382,
                    point: 'POINT (118.04005218067893 24.59351911675743)' },
                { prob: 0.22781613384312263,
                    point: 'POINT (118.03986420503809 24.593397086318344)' } ],
        time: 1592928528000,
        id: '5',
        point: 'POINT (118.03986420503809 24.593397086318344)' },
    { candidates:
            [ { prob: 0.01495045852149075,
                point: 'POINT (118.04154944590925 24.5921353288635)' },
                { prob: 0.01495045852149075,
                    point: 'POINT (118.04154944590925 24.5921353288635)' },
                { prob: 0.2860537158458538,
                    point: 'POINT (118.04141070289192 24.591966785552966)' },
                { prob: 0.19804030130938918,
                    point: 'POINT (118.04145690740896 24.592021762078257)' },
                { prob: 0.0009555243244196866,
                    point: 'POINT (118.04160566511796 24.592203619382303)' },
                { prob: 0.0009555243243054751,
                    point: 'POINT (118.04160566511797 24.5922036193823)' },
                { prob: 0.19804030130336647,
                    point: 'POINT (118.04145690740896 24.592021762078264)' },
                { prob: 0.28605371584968387,
                    point: 'POINT (118.04141070289192 24.591966785552955)' } ],
        time: 1592928545000,
        id: '6',
        point: 'POINT (118.04141070289192 24.591966785552955)' },
    { candidates:
            [ { prob: 0.21737363282839117,
                point: 'POINT (118.04242830151834 24.591370696797892)' },
                { prob: 0.0069218564174517334,
                    point: 'POINT (118.04258405691102 24.591604680987164)' },
                { prob: 0.21890277150856313,
                    point: 'POINT (118.04246672478514 24.591427851183116)' },
                { prob: 0.0069218564174517334,
                    point: 'POINT (118.04258405691102 24.591604680987164)' },
                { prob: 0.2189027715113567,
                    point: 'POINT (118.04246672478514 24.591427851183113)' },
                { prob: 0.0568017392509361,
                    point: 'POINT (118.04253425281773 24.591529768022426)' },
                { prob: 0.056801739237457106,
                    point: 'POINT (118.04253425281773 24.59152976802244)' },
                { prob: 0.2173736328283923,
                    point: 'POINT (118.04242830151833 24.591370696797895)' } ],
        time: 1592928552000,
        id: '7',
        point: 'POINT (118.04246672478514 24.591427851183113)' },
    { candidates:
            [ { prob: 3.9432835563557464e-7,
                point: 'POINT (118.0468965 24.5889342)' },
                { prob: 0.05937041531267083,
                    point: 'POINT (118.04701335640725 24.589466190319108)' },
                { prob: 0.059370415314913445,
                    point: 'POINT (118.04701335640725 24.5894661903191)' },
                { prob: 0.08927475709761545,
                    point: 'POINT (118.04694121068276 24.589335285752124)' },
                { prob: 0.00006122255987924539,
                    point: 'POINT (118.0469638 24.589729299999995)' },
                { prob: 1.4977481485887139e-12,
                    point: 'POINT (118.0474576 24.5898328)' },
                { prob: 0.008956147587293736,
                    point: 'POINT (118.0471324 24.5892521)' },
                { prob: 0.0015522603487495026,
                    point: 'POINT (118.0472409 24.5894515)' },
                { prob: 0.08927475708701516,
                    point: 'POINT (118.04694121068275 24.58933528575212)' },
                { prob: 6.074957841893699e-8,
                    point: 'POINT (118.04744233365379 24.589589667021826)' },
                { prob: 5.124934377139603e-16,
                    point: 'POINT (118.0477497 24.5892318)' },
                { prob: 0.08770176139765584,
                    point: 'POINT (118.0469244 24.5893426)' },
                { prob: 2.8876878738480092e-18,
                    point: 'POINT (118.0473689 24.5900775)' },
                { prob: 0.10310738165263471,
                    point: 'POINT (118.04695086213758 24.589387904350385)' },
                { prob: 0.017124313457803287,
                    point: 'POINT (118.047039 24.5895388)' },
                { prob: 0.00006122255987924539,
                    point: 'POINT (118.0469638 24.589729299999995)' },
                { prob: 0.010268997219237831,
                    point: 'POINT (118.04715540415525 24.58929437682063)' },
                { prob: 0.08770176139765584,
                    point: 'POINT (118.0469244 24.5893426)' },
                { prob: 0.10441754924675829,
                    point: 'POINT (118.0469664065813 24.58938370292647)' },
                { prob: 5.499129787018516e-19,
                    point: 'POINT (118.0461393 24.5896612)' },
                { prob: 0.0009083259580126159,
                    point: 'POINT (118.04667330345298 24.589302204264627)' },
                { prob: 1.3880419502090932e-10,
                    point: 'POINT (118.0466767 24.5888675)' },
                { prob: 0.017124313457803287,
                    point: 'POINT (118.047039 24.5895388)' },
                { prob: 7.042560824861049e-13,
                    point: 'POINT (118.0464308 24.5898061)' },
                { prob: 0.10310738165086113,
                    point: 'POINT (118.04695086213758 24.589387904350392)' },
                { prob: 6.074957841893699e-8,
                    point: 'POINT (118.04744233365379 24.589589667021823)' },
                { prob: 0.0015522603487495026,
                    point: 'POINT (118.0472409 24.5894515)' },
                { prob: 0.10441754924614763,
                    point: 'POINT (118.04696640658132 24.589383702926472)' },
                { prob: 0.0171659077307685,
                    point: 'POINT (118.04704521732056 24.58953611168449)' },
                { prob: 0.00009070034576466491,
                    point: 'POINT (118.04707110000001 24.589056199999998)' },
                { prob: 0.010268997220801334,
                    point: 'POINT (118.04715540415525 24.589294376820632)' },
                { prob: 4.2096990847020806e-9,
                    point: 'POINT (118.0474493 24.5890956)' },
                { prob: 0.0009083259581113353,
                    point: 'POINT (118.04667330345298 24.58930220426463)' },
                { prob: 0.008956147587293736,
                    point: 'POINT (118.0471324 24.5892521)' },
                { prob: 0.00009070034577670352,
                    point: 'POINT (118.04707110000001 24.589056200000005)' },
                { prob: 0.017165907731928668,
                    point: 'POINT (118.04704521732056 24.589536111684488)' } ],
        time: 1592928582000,
        id: '8',
        point: 'POINT (118.0469664065813 24.58938370292647)' },
    { candidates:
            [ { prob: 0.33527172713654524,
                point: 'POINT (118.05167964535713 24.58627877391878)' },
                { prob: 0.33527172713654524,
                    point: 'POINT (118.05167964535713 24.58627877391878)' },
                { prob: 0.1647282728634547,
                    point: 'POINT (118.05179020322673 24.58636342629748)' },
                { prob: 0.1647282728634547,
                    point: 'POINT (118.05179020322673 24.58636342629748)' },
                { prob: 6.451126242231082e-44,
                    point: 'POINT (118.0508386 24.5872861)' },
                { prob: 6.451126242231082e-44,
                    point: 'POINT (118.0508386 24.5872861)' } ],
        time: 1592928612000,
        id: '9',
        point: 'POINT (118.05167964535713 24.58627877391878)' },
    { candidates:
            [ { prob: 0.18251045588817946,
                point: 'POINT (118.05561618259452 24.58214144099042)' },
                { prob: 0.31748954411182057,
                    point: 'POINT (118.05552138420973 24.58206969512369)' },
                { prob: 0.18251045588817946,
                    point: 'POINT (118.05561618259452 24.58214144099042)' },
                { prob: 0.31748954411182057,
                    point: 'POINT (118.05552138420973 24.58206969512369)' } ],
        time: 1592928642000,
        id: '10',
        point: 'POINT (118.05552138420973 24.58206969512369)' },
    { candidates:
            [ { prob: 2.9246295834699203e-64,
                point: 'POINT (118.0584114 24.5790293)' },
                { prob: 0.057337987080489865,
                    point: 'POINT (118.05877567625558 24.57754918354388)' },
                { prob: 0.26236075605088816,
                    point: 'POINT (118.05861579659957 24.577504280385558)' },
                { prob: 0.2623607560532318,
                    point: 'POINT (118.05861579659957 24.577504280385565)' },
                { prob: 0.180301256877278,
                    point: 'POINT (118.05869306356979 24.577525439575464)' },
                { prob: 1.3069876802634676e-39,
                    point: 'POINT (118.0582775 24.5786626)' },
                { prob: 1.3069876802634676e-39,
                    point: 'POINT (118.0582775 24.5786626)' },
                { prob: 0.05733798706636189,
                    point: 'POINT (118.05877567625559 24.57754918354388)' },
                { prob: 2.9246295834699203e-64,
                    point: 'POINT (118.0584114 24.5790293)' },
                { prob: 2.8251623775698387e-57,
                    point: 'POINT (118.0581903 24.5789004)' },
                { prob: 2.8251623775698387e-57,
                    point: 'POINT (118.0581903 24.5789004)' },
                { prob: 4.1821488573655414e-45,
                    point: 'POINT (118.0583082 24.5787549)' },
                { prob: 0.18030125687175036,
                    point: 'POINT (118.05869306356979 24.577525439575457)' } ],
        time: 1592928672000,
        id: '11',
        point: 'POINT (118.05861579659957 24.577504280385565)' },
    { candidates:
            [ { prob: 0.004163400661365468,
                point: 'POINT (118.05906000868423 24.57278632584353)' },
                { prob: 0.02836357314182252,
                    point: 'POINT (118.05898109596203 24.572799589104733)' },
                { prob: 0.02836357314182252,
                    point: 'POINT (118.05898109596203 24.572799589104733)' },
                { prob: 0.1279534194363267,
                    point: 'POINT (118.05879199021663 24.572886950062678)' },
                { prob: 1.878135011744585e-30,
                    point: 'POINT (118.05928002423256 24.57374069281618)' },
                { prob: 4.0583701912875807e-79,
                    point: 'POINT (118.05802362421116 24.571240625526645)' },
                { prob: 0.20363732004802548,
                    point: 'POINT (118.05877955658454 24.57280133070446)' },
                { prob: 8.698690334114167e-14,
                    point: 'POINT (118.0592678 24.572281)' },
                { prob: 0.20363732004802548,
                    point: 'POINT (118.05877955658454 24.57280133070446)' },
                { prob: 1.8781350125089304e-30,
                    point: 'POINT (118.05928002423255 24.57374069281618)' },
                { prob: 6.436438426189169e-8,
                    point: 'POINT (118.05869454106522 24.57231300512208)' },
                { prob: 0.004163400661365468,
                    point: 'POINT (118.05906000868423 24.572786325843534)' },
                { prob: 7.951700614415789e-8,
                    point: 'POINT (118.05838374792629 24.573125441406564)' },
                { prob: 1.1025628456938583e-57,
                    point: 'POINT (118.0590817 24.5742277)' },
                { prob: 1.120529444204117e-19,
                    point: 'POINT (118.0591111 24.5735723)' },
                { prob: 7.951700614415789e-8,
                    point: 'POINT (118.05838374792629 24.573125441406564)' },
                { prob: 1.120529444204117e-19,
                    point: 'POINT (118.0591111 24.5735723)' },
                { prob: 1.1517192615017001e-11,
                    point: 'POINT (118.0586639248564 24.57218975419502)' },
                { prob: 8.698690334114167e-14,
                    point: 'POINT (118.0592678 24.572281)' },
                { prob: 0.13588214282384137,
                    point: 'POINT (118.0586990537126 24.57282105885687)' },
                { prob: 9.766888333493448e-53,
                    point: 'POINT (118.0589841 24.5741759)' },
                { prob: 6.077888919052699e-31,
                    point: 'POINT (118.0591464 24.5737995)' },
                { prob: 4.058370193982751e-79,
                    point: 'POINT (118.05802362421116 24.57124062552666)' },
                { prob: 6.770687493362846e-22,
                    point: 'POINT (118.0594754 24.5721917)' },
                { prob: 0.1279534194275744,
                    point: 'POINT (118.05879199021663 24.572886950062685)' },
                { prob: 3.528080521827194e-31,
                    point: 'POINT (118.0594427 24.5736691)' },
                { prob: 6.436438421214722e-8,
                    point: 'POINT (118.05869454106524 24.57231300512207)' },
                { prob: 1.1517192623407131e-11,
                    point: 'POINT (118.0586639248564 24.572189754195026)' },
                { prob: 0.13588214282384137,
                    point: 'POINT (118.0586990537126 24.57282105885687)' } ],
        time: 1592928702000,
        id: '12',
        point: 'POINT (118.05877955658454 24.57280133070446)' },
    { candidates:
            [ { prob: 0.25812215597720717,
                point: 'POINT (118.05778288950893 24.570356909116303)' },
                { prob: 3.575998578703534e-8,
                    point: 'POINT (118.05809449999998 24.56992189999999)' },
                { prob: 1.0171577724170958e-22,
                    point: 'POINT (118.05819766019677 24.571169559235514)' },
                { prob: 0.16985338208721984,
                    point: 'POINT (118.05771514225287 24.570387137403042)' },
                { prob: 0.16985338208721984,
                    point: 'POINT (118.05771514225287 24.570387137403042)' },
                { prob: 0.0713656716839398,
                    point: 'POINT (118.057643580984 24.57038620966804)' },
                { prob: 0.0713656716839398,
                    point: 'POINT (118.057643580984 24.57038620966804)' },
                { prob: 0.0009729374015730603,
                    point: 'POINT (118.0575786 24.5701253)' },
                { prob: 3.220434913863913e-17,
                    point: 'POINT (118.0581456034845 24.57105535392438)' },
                { prob: 3.575998581544915e-8,
                    point: 'POINT (118.05809450000001 24.56992190000002)' },
                { prob: 0.2581221559878294,
                    point: 'POINT (118.05778288950894 24.570356909116303)' },
                { prob: 3.220434909970377e-17,
                    point: 'POINT (118.0581456034845 24.571055353924383)' },
                { prob: 0.0001722857854086805,
                    point: 'POINT (118.05796459626865 24.570661172112946)' },
                { prob: 0.00017228578547861438,
                    point: 'POINT (118.05796459626865 24.570661172112942)' },
                { prob: 1.0171577734898356e-22,
                    point: 'POINT (118.05819766019677 24.571169559235503)' },
                { prob: 2.1234711730063025e-13,
                    point: 'POINT (118.0576693 24.5710143)' } ],
        time: 1592928719000,
        id: '13',
        point: 'POINT (118.05778288950894 24.570356909116303)' },
    { candidates:
            [ { prob: 0.2612532211487873,
                point: 'POINT (118.0569730488957 24.568668546742995)' },
                { prob: 0.1816217684579216,
                    point: 'POINT (118.05706163918789 24.5686358518359)' },
                { prob: 0.18162176844689343,
                    point: 'POINT (118.0570616391879 24.5686358518359)' },
                { prob: 0.2612532211487873,
                    point: 'POINT (118.0569730488957 24.568668546742995)' },
                { prob: 0.05712501039880523,
                    point: 'POINT (118.0571432699773 24.568606746521805)' },
                { prob: 5.024405440358644e-66,
                    point: 'POINT (118.0575786 24.5701253)' },
                { prob: 5.024405440358644e-66,
                    point: 'POINT (118.0575786 24.5701253)' },
                { prob: 0.05712501039880523,
                    point: 'POINT (118.0571432699773 24.568606746521805)' } ],
        time: 1592928732000,
        id: '14',
        point: 'POINT (118.0569730488957 24.568668546742995)' },
    { candidates:
            [ { prob: 1.3734957295056611e-61,
                point: 'POINT (118.0560055 24.5662012)' },
                { prob: 0.000022777679963276377,
                    point: 'POINT (118.0551705 24.5644599)' },
                { prob: 0.000022777679963276377,
                    point: 'POINT (118.0551705 24.5644599)' },
                { prob: 5.1128970469145006e-27,
                    point: 'POINT (118.05460220000002 24.564067499999997)' },
                { prob: 0.11603545468734068,
                    point: 'POINT (118.05541785816695 24.56480971949865)' },
                { prob: 5.1128970429602e-27,
                    point: 'POINT (118.0546022 24.564067499999993)' },
                { prob: 1.3734957295056611e-61,
                    point: 'POINT (118.0560055 24.5662012)' },
                { prob: 0.3839417676438455,
                    point: 'POINT (118.05533598767131 24.564833055656724)' },
                { prob: 0.38394176764382304,
                    point: 'POINT (118.05533598767131 24.564833055656717)' },
                { prob: 0.11603545466506435,
                    point: 'POINT (118.05541785816695 24.564809719498648)' } ],
        time: 1592928762000,
        id: '15',
        point: 'POINT (118.05533598767131 24.564833055656724)' }
]

let i = 0
mq.AddProducer(conn, function (producer) {
    producer.createTopics(['mapmatching1'], function () {
        setInterval(function() {
            mq.mq_producers['common'].send([{topic:['mapmatching1'],
                messages: [JSON.stringify(pointList[i])]}], function () {
                console.log(pointList[i]);
            })
            i += 1

        }, 2000);
    })
});
